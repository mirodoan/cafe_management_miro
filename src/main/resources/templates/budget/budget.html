<!DOCTYPE html>
<html
        xmlns:th="http://www.thymeleaf.org"
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        layout:decorate="~{layout}"
>
<head>
    <meta charset="UTF-8"/>
    <title>Quản lý Thu Chi</title>
</head>
<body>
<div
        layout:fragment="content"
        class="bg-[#fefae0] min-h-screen w-full px-2 xs:px-4 sm:px-6 py-4 sm:py-8"
>
    <div class="max-w-[900px] mx-auto">
        <div class="bg-white rounded-xl shadow-lg p-3 xs:p-4 sm:p-6">
            <!-- Tiêu đề + nút thêm -->
            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-4 sm:mb-6">
                <h2 class="text-xl xs:text-2xl sm:text-3xl font-bold text-[#3e2723]">Danh sách Thu Chi</h2>
                <a
                        th:href="@{/budget/create}"
                        class="w-full md:w-auto flex justify-center items-center bg-green-600 hover:bg-green-700 text-white font-semibold text-base px-4 py-2 md:px-6 md:h-[48px] rounded shadow mt-2 md:mt-0 text-center"
                >
                    Thêm khoản chi
                </a>
            </div>

            <!-- Form lọc ngày -->
            <form
                    th:action="@{/budget/budget}"
                    method="get"
                    class="flex flex-col xs:flex-row flex-wrap gap-3 sm:gap-4 mb-4 sm:mb-6 items-end"
            >
                <div class="w-full xs:w-auto">
                    <label class="block font-medium mb-1">Từ ngày:</label>
                    <input
                            type="date"
                            name="fromDate"
                            th:value="${filter.fromDate}"
                            class="border px-3 py-2 rounded w-full"
                    />
                </div>
                <div class="w-full xs:w-auto">
                    <label class="block font-medium mb-1">Đến ngày:</label>
                    <input
                            type="date"
                            name="toDate"
                            th:value="${filter.toDate}"
                            class="border px-3 py-2 rounded w-full"
                    />
                </div>
                <div class="w-full xs:w-auto">
                    <button
                            type="submit"
                            class="mt-2 xs:mt-6 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded shadow w-full xs:w-auto"
                    >
                        Xem
                    </button>
                </div>
            </form>

            <!-- Card danh sách thu chi cho mobile (sm:hidden) -->
            <div class="sm:hidden space-y-2 mb-2">
                <div th:each="item : ${budgetPage.content}"
                     class="bg-white rounded-lg shadow border border-gray-200 p-3 flex flex-col gap-2">
                    <div>
                        <span class="block text-xs font-semibold text-gray-400">Ngày</span>
                        <span class="font-medium text-[#3e2723]"
                              th:text="${#temporals.format(item.date, 'dd/MM/yyyy')}"></span>
                    </div>
                    <div>
                        <span class="block text-xs font-semibold text-gray-400">Thu (VND)</span>
                        <span class="text-green-700 font-semibold"
                              th:text="${#numbers.formatDecimal(item.income, 0, 'COMMA', 0, 'POINT')}"></span>
                    </div>
                    <div>
                        <span class="block text-xs font-semibold text-gray-400">Chi (VND)</span>
                        <span class="text-red-700 font-semibold"
                              th:text="${#numbers.formatDecimal(item.expense, 0, 'COMMA', 0, 'POINT')}"></span>
                    </div>
                </div>
                <!-- Nếu không có dữ liệu -->
                <div th:if="${#lists.isEmpty(budgetPage.content)}"
                     class="text-center text-gray-500 italic py-6 bg-white rounded shadow">
                    Không có dữ liệu
                </div>
                <!-- Tổng thu chi -->
                <div class="bg-gray-100 rounded-lg shadow border border-gray-200 p-3 flex flex-col gap-2 font-semibold mt-2">
                    <div>
                        <span class="block text-xs font-semibold text-gray-400">Tổng thu</span>
                        <span class="text-green-800"
                              th:text="${#numbers.formatDecimal(totalIncomeText, 0, 'COMMA', 0, 'POINT')}"></span>
                    </div>
                    <div>
                        <span class="block text-xs font-semibold text-gray-400">Tổng chi</span>
                        <span class="text-red-800"
                              th:text="${#numbers.formatDecimal(totalExpenseText, 0, 'COMMA', 0, 'POINT')}"></span>
                    </div>
                </div>
            </div>

            <!-- Bảng thu chi chỉ hiện ở sm trở lên -->
            <div class="hidden sm:block overflow-x-auto border border-gray-300 rounded-xl shadow bg-white mb-2">
                <table class="w-full text-sm text-gray-800 table-fixed min-w-[420px]">
                    <thead class="bg-[#FFF8E1] text-xs font-semibold text-gray-700 uppercase">
                    <tr>
                        <th class="w-[30%] px-2 sm:px-4 py-2 sm:py-3 text-left">Ngày</th>
                        <th class="w-[35%] px-2 sm:px-4 py-2 sm:py-3 text-right">Thu (VND)</th>
                        <th class="w-[35%] px-2 sm:px-4 py-2 sm:py-3 text-right">Chi (VND)</th>
                    </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200">
                    <tr th:if="${#lists.isEmpty(budgetPage.content)}">
                        <td colspan="3" class="py-6 text-center text-gray-500 italic">
                            Không có dữ liệu
                        </td>
                    </tr>
                    <tr
                            th:each="item : ${budgetPage.content}"
                            class="hover:bg-[#f9f9f9] transition"
                    >
                        <td class="px-2 sm:px-4 py-2 sm:py-3" th:text="${#temporals.format(item.date, 'dd/MM/yyyy')}">
                            01/01/2025
                        </td>
                        <td class="px-2 sm:px-4 py-2 sm:py-3 text-right"
                            th:text="${#numbers.formatDecimal(item.income, 0, 'COMMA', 0, 'POINT')}">
                            0
                        </td>
                        <td class="px-2 sm:px-4 py-2 sm:py-3 text-right"
                            th:text="${#numbers.formatDecimal(item.expense, 0, 'COMMA', 0, 'POINT')}">
                            0
                        </td>
                    </tr>
                    </tbody>
                    <tfoot class="font-semibold bg-gray-100">
                    <tr class="border-t">
                        <td class="px-2 sm:px-4 py-2 sm:py-3">Tổng</td>
                        <td class="px-2 sm:px-4 py-2 sm:py-3 text-right"
                            th:text="${#numbers.formatDecimal(totalIncomeText, 0, 'COMMA', 0, 'POINT')}">
                            0
                        </td>
                        <td class="px-2 sm:px-4 py-2 sm:py-3 text-right"
                            th:text="${#numbers.formatDecimal(totalExpenseText, 0, 'COMMA', 0, 'POINT')}">
                            0
                        </td>
                    </tr>
                    </tfoot>
                </table>
            </div>

            <!-- Phân trang -->
            <div
                    th:if="${budgetPage.totalPages > 1}"
                    class="flex flex-col xs:flex-row items-center justify-between mt-4 sm:mt-6 text-xs sm:text-sm text-gray-600 gap-2"
            >
                <div>
                    <span th:text="'Trang ' + (${budgetPage.number + 1}) + ' / ' + ${budgetPage.totalPages}">Trang 1 / 1</span>
                </div>
                <nav>
                    <ul class="inline-flex items-center gap-1">
                        <li>
                            <a
                                    th:href="@{/budget/budget(fromDate=${filter.fromDate}, toDate=${filter.toDate}, page=${budgetPage.number - 1})}"
                                    th:class="'px-2 sm:px-3 py-1.5 rounded border transition ' + (${budgetPage.number == 0} ? 'text-gray-300 border-gray-300 bg-gray-100 cursor-not-allowed pointer-events-none' : 'text-blue-600 border-blue-300 hover:bg-blue-50')"
                            >
                                Trước
                            </a>
                        </li>
                        <li th:each="pageNum : ${#numbers.sequence(0, budgetPage.totalPages - 1)}">
                            <a
                                    th:href="@{/budget/budget(fromDate=${filter.fromDate}, toDate=${filter.toDate}, page=${pageNum})}"
                                    th:text="${pageNum + 1}"
                                    th:class="'px-2 sm:px-3 py-1.5 rounded border text-xs sm:text-sm font-medium transition ' +
                                         (${pageNum} == ${budgetPage.number} ? 'bg-blue-600 text-white border-blue-600' : 'border-gray-300 text-gray-700 hover:bg-blue-50')"
                            ></a>
                        </li>
                        <li>
                            <a
                                    th:href="@{/budget/budget(fromDate=${filter.fromDate}, toDate=${filter.toDate}, page=${budgetPage.number + 1})}"
                                    th:class="'px-2 sm:px-3 py-1.5 rounded border transition ' + (${budgetPage.number + 1 >= budgetPage.totalPages} ? 'text-gray-300 border-gray-300 bg-gray-100 cursor-not-allowed pointer-events-none' : 'text-blue-600 border-blue-300 hover:bg-blue-50')"
                            >
                                Tiếp
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>
</div>
</body>
</html>