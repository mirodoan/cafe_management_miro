<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <meta charset="UTF-8">
    <title>Qu·∫£n l√Ω khuy·∫øn m√£i</title>
</head>
<body>
<div layout:fragment="content" class="bg-[#fefae0] min-h-screen w-full px-6 py-8">
    <div class="max-w-[1500px] mx-auto">
        <div class="bg-white rounded-xl shadow-lg p-6">

            <!-- Ti√™u ƒë·ªÅ v√† n√∫t th√™m khuy·∫øn m√£i -->
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-3xl font-bold text-[#3e2723]">Danh s√°ch khuy·∫øn m√£i</h2>
                <a th:href="@{/promotion/create}"
                   class="bg-blue-600 hover:bg-blue-700 text-white font-semibold text-sm px-4 py-2 rounded shadow">
                    Th√™m khuy·∫øn m√£i
                </a>
            </div>

            <!-- Form t√¨m ki·∫øm khuy·∫øn m√£i -->
            <div class="mb-6">
                <form th:action="@{/promotion}" method="get" class="flex gap-3">
                    <div class="flex-1 relative">
                        <input
                                type="text"
                                name="keyword"
                                id="searchInput"
                                th:value="${param.keyword}"
                                placeholder="T√¨m ki·∫øm theo t√™n khuy·∫øn m√£i..."
                                class="w-full px-4 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"
                        />

                    </div>
                    <button
                            type="submit"
                            class="bg-green-600 hover:bg-green-700 text-white font-medium px-6 py-2 rounded-lg shadow transition"
                    >
                        üîç T√¨m ki·∫øm
                    </button>
                </form>

                <!-- Hi·ªÉn th·ªã breadcrumb khi c√≥ t·ª´ kh√≥a t√¨m ki·∫øm -->
                <div
                        th:if="${param.keyword != null and param.keyword[0] != null and !param.keyword[0].isEmpty()}"
                        class="mt-2"
                >
                    <span class="text-sm text-gray-600">
                        K·∫øt qu·∫£ t√¨m ki·∫øm cho: "<span
                            th:text="${param.keyword[0]}"
                            class="font-semibold text-blue-600"
                    ></span
                    >" ‚Ä¢
                        <a
                                th:href="@{/promotion}"
                                class="text-blue-600 hover:text-blue-800 underline"
                        >Xem t·∫•t c·∫£ khuy·∫øn m√£i</a>
                    </span>
                </div>
            </div>

            <!-- B·∫£ng danh s√°ch khuy·∫øn m√£i -->
            <div class="overflow-x-auto border border-gray-300 rounded-xl shadow bg-white">
                <table class="w-full text-sm text-gray-800 table-fixed">
                    <thead class="bg-[#FFF8E1] text-xs font-semibold text-gray-700 uppercase">
                    <tr>
                        <th class="w-[25%] px-4 py-3 text-left">T√™n khuy·∫øn m√£i</th>
                        <th class="w-[20%] px-4 py-3 text-left">Ng√†y b·∫Øt ƒë·∫ßu</th>
                        <th class="w-[20%] px-4 py-3 text-left">Ng√†y k·∫øt th√∫c</th>
                        <th class="w-[15%] px-4 py-3 text-right">Gi·∫£m (%)</th>
                        <th class="w-[20%] px-4 py-3 text-center">Thao t√°c</th>
                    </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200">
                    <!-- L·∫∑p qua danh s√°ch khuy·∫øn m√£i ƒë·ªÉ hi·ªÉn th·ªã t·ª´ng d√≤ng -->
                    <tr th:each="promotion : ${promotions}" class="hover:bg-[#f9f9f9] transition">
                        <td class="px-4 py-3 font-medium" th:text="${promotion.promotionName}">Gi·∫£m bu·ªïi s√°ng</td>
                        <td class="px-4 py-3" th:text="${#temporals.format(promotion.startDate, 'dd/MM/yyyy')}">
                            01/01/2025
                        </td>
                        <td class="px-4 py-3" th:text="${#temporals.format(promotion.endDate, 'dd/MM/yyyy')}">
                            31/01/2025
                        </td>
                        <td class="px-4 py-3 text-right" th:text="${promotion.discountValue + '%'}">15%</td>
                        <td class="px-4 py-3">
                            <div class="flex justify-center gap-2">
                                <!-- N√∫t s·ª≠a khuy·∫øn m√£i -->
                                <a th:href="@{/promotion/update/{id}(id=${promotion.id})}"
                                   class="bg-yellow-400 hover:bg-yellow-500 text-white text-xs font-medium px-3 py-1.5 rounded shadow">
                                    S·ª≠a
                                </a>
                                <!-- N√∫t x√≥a khuy·∫øn m√£i (x√≥a m·ªÅm) -->
                                <form th:action="@{/promotion/delete/{id}(id=${promotion.id})}" method="post"
                                      th:id="'deleteForm-' + ${promotion.id}">
                                    <button type="button"
                                            th:attr="data-id=${promotion.id}, data-name=${promotion.promotionName}"
                                            class="btn-delete bg-red-500 hover:bg-red-600 text-white text-xs font-medium px-3 py-1.5 rounded shadow transition">
                                        X√≥a
                                    </button>
                                </form>
                            </div>
                        </td>
                    </tr>

                    <!-- Hi·ªÉn th·ªã n·∫øu kh√¥ng c√≥ d·ªØ li·ªáu -->
                    <tr th:if="${#lists.isEmpty(promotions)}">
                        <td colspan="5" class="text-center text-gray-500 italic py-6">
                            <span
                                    th:if="${param.keyword != null and param.keyword[0] != null and !param.keyword[0].isEmpty()}"
                                    th:text="'Kh√¥ng t√¨m th·∫•y khuy·∫øn m√£i n√†o v·ªõi t·ª´ kh√≥a: ' + ${param.keyword[0]}"
                            ></span>
                            <span
                                    th:unless="${param.keyword != null and param.keyword[0] != null and !param.keyword[0].isEmpty()}"
                            >
                              Kh√¥ng c√≥ khuy·∫øn m√£i n√†o ƒë∆∞·ª£c t√¨m th·∫•y.
                            </span>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <!-- Ph√¢n trang danh s√°ch khuy·∫øn m√£i -->
            <div class="flex items-center justify-between mt-6 text-sm text-gray-600">
                <div>
                    <span th:text="'Trang ' + (${currentPage + 1}) + ' / ' + ${totalPages}">Trang 1 / 1</span>
                    |
                    <span th:text="'T·ªïng: ' + ${totalElements} + ' khuy·∫øn m√£i'">T·ªïng: 0 khuy·∫øn m√£i</span>
                </div>
                <nav>
                    <ul class="inline-flex items-center gap-1">
                        <!-- N√∫t trang tr∆∞·ªõc -->
                        <li>
                            <a th:href="@{/promotion(page=${currentPage - 1}, keyword=${param.keyword})}"
                               th:class="'px-3 py-1.5 rounded border transition ' + (${currentPage == 0} ? 'text-gray-300 border-gray-300 bg-gray-100 cursor-not-allowed pointer-events-none' : 'text-blue-600 border-blue-300 hover:bg-blue-50')">
                                Tr∆∞·ªõc
                            </a>
                        </li>

                        <!-- C√°c s·ªë trang -->
                        <li th:each="pageNum : ${#numbers.sequence(0, totalPages - 1)}">
                            <a th:href="@{/promotion(page=${pageNum}, keyword=${param.keyword})}"
                               th:text="${pageNum + 1}"
                               th:class="'px-3 py-1.5 rounded border text-sm font-medium transition ' +
                                         (${pageNum} == ${currentPage} ? 'bg-blue-600 text-white border-blue-600' : 'border-gray-300 text-gray-700 hover:bg-blue-50')">
                            </a>
                        </li>

                        <!-- N√∫t trang ti·∫øp -->
                        <li>
                            <a th:href="@{/promotion(page=${currentPage + 1}, keyword=${param.keyword})}"
                               th:class="'px-3 py-1.5 rounded border transition ' + (${currentPage + 1 >= totalPages} ? 'text-gray-300 border-gray-300 bg-gray-100 cursor-not-allowed pointer-events-none' : 'text-blue-600 border-blue-300 hover:bg-blue-50')">
                                Ti·∫øp
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>

        </div>
    </div>
</div>

<script>
    // Khi nh·∫≠p v√†o input t√¨m ki·∫øm
    if (searchInput) {
      // Nh·∫•n Enter khi ƒëang focus input t√¨m ki·∫øm s·∫Ω submit form
      searchInput.addEventListener('keypress', function (e) {
        if (e.key === 'Enter') {
          e.preventDefault();
          if (searchForm) searchForm.submit();
        }
      });
    }

    // X·ª≠ l√Ω n√∫t x√≥a khuy·∫øn m√£i: x√°c nh·∫≠n tr∆∞·ªõc khi submit form x√≥a
    const deleteButtons = document.querySelectorAll('.btn-delete');
    deleteButtons.forEach((button) => {
      button.addEventListener('click', function (e) {
        e.preventDefault();
        const promotionId = this.getAttribute('data-id');
        const promotionName = this.getAttribute('data-name');

        // X√°c nh·∫≠n v·ªõi ng∆∞·ªùi d√πng tr∆∞·ªõc khi x√≥a
        if (
          confirm(`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a khuy·∫øn m√£i "${promotionName}"?`)
        ) {
          const form = document.getElementById('deleteForm-' + promotionId);
          if (form) {
            form.submit();
          }
        }
      });
    });
</script>
</body>
</html>