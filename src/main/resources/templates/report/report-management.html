<!DOCTYPE html>
<html
        xmlns:th="http://www.thymeleaf.org"
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        layout:decorate="~{layout}"
>
<head>
    <meta charset="UTF-8"/>
    <title>B√°o c√°o th·ªëng k√™</title>
    <script>
        function validateForm() {
          const start = document.getElementById('start').value;
          const end = document.getElementById('end').value;
          const now = new Date().toISOString().split('T')[0];
          if (start > end) {
            alert('‚ö†Ô∏è T·ª´ ng√†y ph·∫£i nh·ªè h∆°n ho·∫∑c b·∫±ng ƒë·∫øn ng√†y.');
            return false;
          }
          if (start > now || end > now) {
            alert('‚ö†Ô∏è Ng√†y kh√¥ng ƒë∆∞·ª£c v∆∞·ª£t qu√° ng√†y hi·ªán t·∫°i.');
            return false;
          }
          return true;
        }
    </script>
</head>
<body>
<div
        layout:fragment="content"
        class="bg-[#fefae0] min-h-screen w-full px-2 xs:px-4 sm:px-6 py-4 sm:py-8"
>
    <div class="max-w-[1100px] mx-auto">
        <div class="bg-white rounded-xl shadow-lg p-3 xs:p-4 sm:p-6">
            <!-- Ti√™u ƒë·ªÅ -->
            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-4 sm:mb-6">
                <h2 class="text-xl xs:text-2xl sm:text-3xl font-bold text-[#3e2723]">
                    üìà B√°o c√°o th·ªëng k√™
                </h2>
                <button
                        id="downloadExcelBtn"
                        class="w-full md:w-auto flex justify-center items-center bg-blue-600 hover:bg-blue-700 text-white font-semibold text-base px-4 py-2 md:px-6 md:h-[48px] rounded shadow mt-2 md:mt-0 text-center"
                >
                    üìÖ T·∫£i Excel
                </button>
                <a
                        id="hiddenExcelLink"
                        th:href="@{/report/download-excel(startDate=${startDate}, endDate=${endDate}, type=${type})}"
                        target="_blank"
                        style="display:none"
                ></a>
            </div>
            <!-- Form l·ªçc -->
            <form
                    method="get"
                    action="/report"
                    onsubmit="return validateForm()"
                    class="flex flex-col xs:flex-row flex-wrap gap-3 sm:gap-4 mb-4 sm:mb-6 items-end"
            >
                <div class="w-full xs:w-auto">
                    <label class="block font-medium mb-1">T·ª´ ng√†y:</label>
                    <input
                            type="date"
                            name="startDate"
                            id="start"
                            required
                            th:value="${startDate}"
                            class="border px-3 py-2 rounded w-full"
                    />
                </div>
                <div class="w-full xs:w-auto">
                    <label class="block font-medium mb-1">ƒê·∫øn ng√†y:</label>
                    <input
                            type="date"
                            name="endDate"
                            id="end"
                            required
                            th:value="${endDate}"
                            class="border px-3 py-2 rounded w-full"
                    />
                </div>
                <div class="w-full xs:w-auto">
                    <label class="block font-medium mb-1">Lo·∫°i b√°o c√°o:</label>
                    <select
                            name="type"
                            id="type"
                            required
                            class="border px-3 py-2 rounded w-full"
                    >
                        <option
                                th:value="EMPLOYEE_SALARY"
                                th:selected="${type == 'EMPLOYEE_SALARY'}"
                        >
                            üë• Nh√¢n vi√™n & L∆∞∆°ng
                        </option>
                        <option
                                th:value="INVOICE_MONTHLY"
                                th:selected="${type == 'INVOICE_MONTHLY'}"
                        >
                            üßæ H√≥a ƒë∆°n
                        </option>
                        <option
                                th:value="REVENUE_SUMMARY"
                                th:selected="${type == 'REVENUE_SUMMARY'}"
                        >
                            üìä Doanh thu - Chi ph√≠
                        </option>
                        <option
                                th:value="EXPENSE_ONLY"
                                th:selected="${type == 'EXPENSE_ONLY'}"
                        >
                            üí∏ Chi ti√™u kh√°c
                        </option>
                        <option
                                th:value="IMPORT_ONLY"
                                th:selected="${type == 'IMPORT_ONLY'}"
                        >
                            üìÖ Nh·∫≠p h√†ng
                        </option>
                        <option
                                th:value="EXPORT_ONLY"
                                th:selected="${type == 'EXPORT_ONLY'}"
                        >
                            üìÑ Xu·∫•t h√†ng
                        </option>
                        <option
                                th:value="IMPORT_EXPORT"
                                th:selected="${type == 'IMPORT_EXPORT'}"
                        >
                            üîÑ Nh·∫≠p - Xu·∫•t
                        </option>
                    </select>
                </div>
                <div class="w-full xs:w-auto">
                    <button
                            type="submit"
                            class="mt-2 xs:mt-6 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded shadow w-full xs:w-auto"
                    >
                        üîç Xem b√°o c√°o
                    </button>
                </div>
            </form>
            <!-- Th√¥ng b√°o l·ªói -->
            <div
                    th:if="${error}"
                    class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4"
                    th:text="${error}"
            ></div>
            <!-- Kh√¥ng c√≥ d·ªØ li·ªáu -->
            <div
                    th:if="${reportData != null and #lists.isEmpty(reportData)}"
                    class="bg-yellow-100 border border-yellow-400 text-yellow-800 px-4 py-3 rounded mb-4"
            >
                ‚ö†Ô∏è Kh√¥ng c√≥ d·ªØ li·ªáu trong kho·∫£ng th·ªùi gian ƒë√£ ch·ªçn.
            </div>

            <!-- K·∫øt qu·∫£ -->
            <div th:if="${reportData != null and !#lists.isEmpty(reportData)}">
                <div th:if="${reportData != null and !#lists.isEmpty(reportData)}">
                    <div id="reportDataExist" style="display:none"></div>
                    <div class="sm:hidden space-y-2 mb-2">
                        <div th:switch="${type}">
                            <!-- EMPLOYEE_SALARY -->
                            <div th:case="'EMPLOYEE_SALARY'">
                                <div th:each="e : ${reportData}"
                                     class="bg-white rounded-lg shadow border border-gray-200 p-3 flex flex-col gap-1">
                                    <div>
                                        <span class="block text-xs font-semibold text-gray-400">H·ªç t√™n</span>
                                        <span class="font-medium text-[#3e2723]" th:text="${e.fullName}"></span>
                                    </div>
                                    <div>
                                        <span class="block text-xs font-semibold text-gray-400">SƒêT</span>
                                        <span th:text="${e.phoneNumber}"></span>
                                    </div>
                                    <div>
                                        <span class="block text-xs font-semibold text-gray-400">ƒê·ªãa ch·ªâ</span>
                                        <span th:text="${e.address}"></span>
                                    </div>
                                    <div>
                                        <span class="block text-xs font-semibold text-gray-400">Ch·ª©c v·ª•</span>
                                        <span th:text="${e.position.positionName}"></span>
                                    </div>
                                    <div>
                                        <span class="block text-xs font-semibold text-gray-400">L∆∞∆°ng (VND)</span>
                                        <span th:text="${#numbers.formatDecimal(e.position.salary, 0, 'COMMA', 0, 'POINT')}"></span>
                                    </div>
                                </div>
                            </div>
                            <!-- INVOICE_MONTHLY -->
                            <div th:case="'INVOICE_MONTHLY'">
                                <div th:each="inv : ${reportData}"
                                     class="bg-white rounded-lg shadow border border-gray-200 p-3 flex flex-col gap-1">
                                    <div>
                                        <span class="block text-xs font-semibold text-gray-400">M√£ h√≥a ƒë∆°n</span>
                                        <span class="font-medium text-[#3e2723]" th:text="${inv.id}"></span>
                                    </div>
                                    <div>
                                        <span class="block text-xs font-semibold text-gray-400">Ng√†y t·∫°o</span>
                                        <span th:text="${#temporals.format(inv.createdAt, 'dd/MM/yyyy HH:mm')}"></span>
                                    </div>
                                    <div>
                                        <span class="block text-xs font-semibold text-gray-400">T·ªïng ti·ªÅn (VND)</span>
                                        <span th:text="${#numbers.formatDecimal(inv.totalAmount, 0, 'COMMA', 0, 'POINT')}"></span>
                                    </div>
                                </div>
                            </div>
                            <!-- REVENUE_SUMMARY -->
                            <div th:case="'REVENUE_SUMMARY'">
                                <div th:each="r : ${reportData[0].summaries}"
                                     class="bg-white rounded-lg shadow border border-gray-200 p-3 flex flex-col gap-1">
                                    <div>
                                        <span class="block text-xs font-semibold text-gray-400">Ng√†y</span>
                                        <span class="font-medium text-[#3e2723]" th:text="${r.date}"></span>
                                    </div>
                                    <div>
                                        <span class="block text-xs font-semibold text-gray-400">Doanh thu (VND)</span>
                                        <span th:text="${#numbers.formatDecimal(r.income, 0, 'COMMA', 0, 'POINT')}"></span>
                                    </div>
                                    <div>
                                        <span class="block text-xs font-semibold text-gray-400">Chi ph√≠</span>
                                        <span th:text="${#numbers.formatDecimal(r.expense, 0, 'COMMA', 0, 'POINT')}"></span>
                                    </div>
                                </div>
                                <div class="bg-gray-100 rounded-lg shadow border border-gray-200 p-3 flex flex-col gap-2 font-semibold mt-2">
                                    <div>
                                        <span class="block text-xs font-semibold text-gray-400">T·ªïng doanh thu (VND)</span>
                                        <span class="text-green-800"
                                              th:text="${#numbers.formatDecimal(reportData[0].totalIncome, 0, 'COMMA', 0, 'POINT')}"></span>
                                    </div>
                                    <div>
                                        <span class="block text-xs font-semibold text-gray-400">T·ªïng chi ph√≠ (VND)</span>
                                        <span class="text-red-800"
                                              th:text="${#numbers.formatDecimal(reportData[0].totalExpense, 0, 'COMMA', 0, 'POINT')}"></span>
                                    </div>
                                </div>
                            </div>
                            <!-- EXPENSE_ONLY -->
                            <div th:case="'EXPENSE_ONLY'">
                                <div th:each="ex : ${reportData}"
                                     class="bg-white rounded-lg shadow border border-gray-200 p-3 flex flex-col gap-1">
                                    <div>
                                        <span class="block text-xs font-semibold text-gray-400">T√™n chi ti√™u</span>
                                        <span class="font-medium text-[#3e2723]" th:text="${ex.expenseName}"></span>
                                    </div>
                                    <div>
                                        <span class="block text-xs font-semibold text-gray-400">Ng√†y</span>
                                        <span th:text="${ex.expenseDate}"></span>
                                    </div>
                                    <div>
                                        <span class="block text-xs font-semibold text-gray-400">S·ªë ti·ªÅn (VND)</span>
                                        <span th:text="${#numbers.formatDecimal(ex.amount, 0, 'COMMA', 0, 'POINT')}"></span>
                                    </div>
                                </div>
                            </div>
                            <!-- IMPORT_ONLY -->
                            <div th:case="'IMPORT_ONLY'">
                                <div th:each="imp : ${reportData}"
                                     class="bg-white rounded-lg shadow border border-gray-200 p-3 flex flex-col gap-1">
                                    <div>
                                        <span class="block text-xs font-semibold text-gray-400">S·∫£n ph·∫©m</span>
                                        <span class="font-medium text-[#3e2723]"
                                              th:text="${imp.product.productName}"></span>
                                    </div>
                                    <div>
                                        <span class="block text-xs font-semibold text-gray-400">Ng√†y nh·∫≠p</span>
                                        <span th:text="${imp.importDate}"></span>
                                    </div>
                                    <div>
                                        <span class="block text-xs font-semibold text-gray-400">S·ªë l∆∞·ª£ng</span>
                                        <span th:text="${imp.quantity}"></span>
                                    </div>
                                    <div>
                                        <span class="block text-xs font-semibold text-gray-400">T·ªïng ti·ªÅn (VND)</span>
                                        <span th:text="${#numbers.formatDecimal(imp.unitImportPrice * imp.quantity, 0, 'COMMA', 0, 'POINT')}"></span>
                                    </div>
                                    <div>
                                        <span class="block text-xs font-semibold text-gray-400">Nh√¢n vi√™n</span>
                                        <span th:text="${imp.employee.fullName}"></span>
                                    </div>
                                </div>
                            </div>
                            <!-- EXPORT_ONLY -->
                            <div th:case="'EXPORT_ONLY'">
                                <div th:each="ex : ${reportData}"
                                     class="bg-white rounded-lg shadow border border-gray-200 p-3 flex flex-col gap-1">
                                    <div>
                                        <span class="block text-xs font-semibold text-gray-400">S·∫£n ph·∫©m</span>
                                        <span class="font-medium text-[#3e2723]"
                                              th:text="${ex.product.productName}"></span>
                                    </div>
                                    <div>
                                        <span class="block text-xs font-semibold text-gray-400">Ng√†y xu·∫•t</span>
                                        <span th:text="${ex.exportDate}"></span>
                                    </div>
                                    <div>
                                        <span class="block text-xs font-semibold text-gray-400">S·ªë l∆∞·ª£ng</span>
                                        <span th:text="${ex.quantity}"></span>
                                    </div>
                                    <div>
                                        <span class="block text-xs font-semibold text-gray-400">T·ªïng ti·ªÅn (VND)</span>
                                        <span th:text="${#numbers.formatDecimal(ex.unitExportPrice * ex.quantity, 0, 'COMMA', 0, 'POINT')}"></span>
                                    </div>
                                    <div>
                                        <span class="block text-xs font-semibold text-gray-400">Nh√¢n vi√™n</span>
                                        <span th:text="${ex.employee.fullName}"></span>
                                    </div>
                                </div>
                            </div>
                            <!-- IMPORT_EXPORT -->
                            <div th:case="'IMPORT_EXPORT'">
                                <h6 class="font-bold mt-3 mb-2 text-[#3e2723]">
                                    üìÖ Nh·∫≠p h√†ng
                                </h6>
                                <div th:each="imp : ${reportData[0].imports}"
                                     class="bg-white rounded-lg shadow border border-gray-200 p-3 flex flex-col gap-1 mb-2">
                                    <div>
                                        <span class="block text-xs font-semibold text-gray-400">S·∫£n ph·∫©m</span>
                                        <span class="font-medium text-[#3e2723]"
                                              th:text="${imp.product.productName}"></span>
                                    </div>
                                    <div>
                                        <span class="block text-xs font-semibold text-gray-400">Ng√†y nh·∫≠p</span>
                                        <span th:text="${imp.importDate}"></span>
                                    </div>
                                    <div>
                                        <span class="block text-xs font-semibold text-gray-400">S·ªë l∆∞·ª£ng</span>
                                        <span th:text="${imp.quantity}"></span>
                                    </div>
                                    <div>
                                        <span class="block text-xs font-semibold text-gray-400">T·ªïng ti·ªÅn (VND)</span>
                                        <span th:text="${#numbers.formatDecimal(imp.unitImportPrice * imp.quantity, 0, 'COMMA', 0, 'POINT')}"></span>
                                    </div>
                                    <div>
                                        <span class="block text-xs font-semibold text-gray-400">Nh√¢n vi√™n</span>
                                        <span th:text="${imp.employee.fullName}"></span>
                                    </div>
                                </div>
                                <h6 class="font-bold mt-4 mb-2 text-[#3e2723]">
                                    üìÑ Xu·∫•t h√†ng
                                </h6>
                                <div th:each="ex : ${reportData[0].exports}"
                                     class="bg-white rounded-lg shadow border border-gray-200 p-3 flex flex-col gap-1 mb-2">
                                    <div>
                                        <span class="block text-xs font-semibold text-gray-400">S·∫£n ph·∫©m</span>
                                        <span class="font-medium text-[#3e2723]"
                                              th:text="${ex.product.productName}"></span>
                                    </div>
                                    <div>
                                        <span class="block text-xs font-semibold text-gray-400">Ng√†y xu·∫•t</span>
                                        <span th:text="${ex.exportDate}"></span>
                                    </div>
                                    <div>
                                        <span class="block text-xs font-semibold text-gray-400">S·ªë l∆∞·ª£ng</span>
                                        <span th:text="${ex.quantity}"></span>
                                    </div>
                                    <div>
                                        <span class="block text-xs font-semibold text-gray-400">T·ªïng ti·ªÅn (VND)</span>
                                        <span th:text="${#numbers.formatDecimal(ex.unitExportPrice * ex.quantity, 0, 'COMMA', 0, 'POINT')}"></span>
                                    </div>
                                    <div>
                                        <span class="block text-xs font-semibold text-gray-400">Nh√¢n vi√™n</span>
                                        <span th:text="${ex.employee.fullName}"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Table ch·ªâ hi·ªán ·ªü sm tr·ªü l√™n -->
                    <div class="hidden sm:block overflow-x-auto border border-gray-300 rounded-xl shadow bg-white mt-4">
                        <div th:switch="${type}">
                            <!-- EMPLOYEE_SALARY -->
                            <table
                                    th:case="'EMPLOYEE_SALARY'"
                                    class="min-w-full text-sm text-gray-800"
                            >
                                <thead
                                        class="bg-[#FFF8E1] text-xs font-semibold text-gray-700 uppercase"
                                >
                                <tr>
                                    <th class="px-2 sm:px-4 py-2 sm:py-3 text-left">H·ªç t√™n</th>
                                    <th class="px-2 sm:px-4 py-2 sm:py-3 text-left">SƒêT</th>
                                    <th class="px-2 sm:px-4 py-2 sm:py-3 text-left">ƒê·ªãa ch·ªâ</th>
                                    <th class="px-2 sm:px-4 py-2 sm:py-3 text-left">Ch·ª©c v·ª•</th>
                                    <th class="px-2 sm:px-4 py-2 sm:py-3 text-right">L∆∞∆°ng (VND)</th>
                                </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200">
                                <tr th:each="e : ${reportData}">
                                    <td class="px-2 sm:px-4 py-2 sm:py-3 text-left" th:text="${e.fullName}">T√™n</td>
                                    <td class="px-2 sm:px-4 py-2 sm:py-3 text-left" th:text="${e.phoneNumber}">SƒêT</td>
                                    <td class="px-2 sm:px-4 py-2 sm:py-3 text-left" th:text="${e.address}">ƒê·ªãa ch·ªâ</td>
                                    <td class="px-2 sm:px-4 py-2 sm:py-3 text-left"
                                        th:text="${e.position.positionName}">
                                        Ch·ª©c v·ª•
                                    </td>
                                    <td class="px-2 sm:px-4 py-2 sm:py-3 text-right"
                                        th:text="${#numbers.formatDecimal(e.position.salary, 0, 'COMMA', 0, 'POINT')}">
                                        L∆∞∆°ng
                                        (VND)
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                            <!-- INVOICE_MONTHLY -->
                            <table
                                    th:case="'INVOICE_MONTHLY'"
                                    class="min-w-full text-sm text-gray-800"
                            >
                                <thead class="bg-[#FFF8E1] text-xs font-semibold text-gray-700 uppercase">
                                <tr>
                                    <th class="px-2 sm:px-4 py-2 sm:py-3 text-left">M√£ h√≥a ƒë∆°n</th>
                                    <th class="px-2 sm:px-4 py-2 sm:py-3 text-left">Ng√†y t·∫°o</th>
                                    <th class="px-2 sm:px-4 py-2 sm:py-3 text-right">T·ªïng ti·ªÅn (VND)</th>
                                </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200">
                                <tr th:each="inv : ${reportData}">
                                    <td class="px-2 sm:px-4 py-2 sm:py-3 text-left" th:text="${inv.id}">#</td>
                                    <td class="px-2 sm:px-4 py-2 sm:py-3 text-left"
                                        th:text="${#temporals.format(inv.createdAt, 'dd/MM/yyyy HH:mm')}">Ng√†y
                                    </td>
                                    <td class="px-2 sm:px-4 py-2 sm:py-3 text-right"
                                        th:text="${#numbers.formatDecimal(inv.totalAmount, 0, 'COMMA', 0, 'POINT')}">
                                        T·ªïng
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                            <!-- REVENUE_SUMMARY -->
                            <table
                                    th:case="'REVENUE_SUMMARY'"
                                    class="min-w-full text-sm text-gray-800"
                            >
                                <thead class="bg-[#FFF8E1] text-xs font-semibold text-gray-700 uppercase">
                                <tr>
                                    <th class="px-2 sm:px-4 py-2 sm:py-3 text-left">Ng√†y</th>
                                    <th class="px-2 sm:px-4 py-2 sm:py-3 text-right">Doanh thu (VND)</th>
                                    <th class="px-2 sm:px-4 py-2 sm:py-3 text-right">Chi ph√≠ (VND)</th>
                                </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200">
                                <tr th:each="r : ${reportData[0].summaries}">
                                    <td class="px-2 sm:px-4 py-2 sm:py-3 text-left" th:text="${r.date}">Ng√†y</td>
                                    <td class="px-2 sm:px-4 py-2 sm:py-3 text-right"
                                        th:text="${#numbers.formatDecimal(r.income, 0, 'COMMA', 0, 'POINT')}">Doanh thu
                                        (VND)
                                    </td>
                                    <td class="px-2 sm:px-4 py-2 sm:py-3 text-right"
                                        th:text="${#numbers.formatDecimal(r.expense, 0, 'COMMA', 0, 'POINT')}">Chi ph√≠
                                        (VND)
                                    </td>
                                </tr>
                                </tbody>
                                <tfoot class="font-semibold bg-gray-100">
                                <tr class="border-t">
                                    <td class="px-2 sm:px-4 py-2 sm:py-3 text-left">T·ªïng</td>
                                    <td class="px-2 sm:px-4 py-2 sm:py-3 text-right"
                                        th:text="${#numbers.formatDecimal(reportData[0].totalIncome, 0, 'COMMA', 0, 'POINT')}">
                                        0
                                    </td>
                                    <td class="px-2 sm:px-4 py-2 sm:py-3 text-right"
                                        th:text="${#numbers.formatDecimal(reportData[0].totalExpense, 0, 'COMMA', 0, 'POINT')}">
                                        0
                                    </td>
                                </tr>
                                </tfoot>
                            </table>
                            <!-- EXPENSE_ONLY -->
                            <table th:case="'EXPENSE_ONLY'" class="min-w-full text-sm text-gray-800">
                                <thead class="bg-[#FFF8E1] text-xs font-semibold text-gray-700 uppercase">
                                <tr>
                                    <th class="px-2 sm:px-4 py-2 sm:py-3 text-left">T√™n chi ti√™u</th>
                                    <th class="px-2 sm:px-4 py-2 sm:py-3 text-left">Ng√†y</th>
                                    <th class="px-2 sm:px-4 py-2 sm:py-3 text-right">S·ªë ti·ªÅn (VND)</th>
                                </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200">
                                <tr th:each="ex : ${reportData}">
                                    <td class="px-2 sm:px-4 py-2 sm:py-3 text-left" th:text="${ex.expenseName}">T√™n</td>
                                    <td class="px-2 sm:px-4 py-2 sm:py-3 text-left" th:text="${ex.expenseDate}">Ng√†y
                                    </td>
                                    <td class="px-2 sm:px-4 py-2 sm:py-3 text-right"
                                        th:text="${#numbers.formatDecimal(ex.amount, 0, 'COMMA', 0, 'POINT')}">S·ªë ti·ªÅn
                                        (VND)
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                            <!-- IMPORT_ONLY -->
                            <table th:case="'IMPORT_ONLY'" class="min-w-full text-sm text-gray-800">
                                <thead class="bg-[#FFF8E1] text-xs font-semibold text-gray-700 uppercase">
                                <tr>
                                    <th class="px-2 sm:px-4 py-2 sm:py-3 text-left">S·∫£n ph·∫©m</th>
                                    <th class="px-2 sm:px-4 py-2 sm:py-3 text-left">Ng√†y nh·∫≠p</th>
                                    <th class="px-2 sm:px-4 py-2 sm:py-3 text-right">S·ªë l∆∞·ª£ng</th>
                                    <th class="px-2 sm:px-4 py-2 sm:py-3 text-right">T·ªïng ti·ªÅn (VND)</th>
                                    <th class="px-2 sm:px-4 py-2 sm:py-3 text-left">Nh√¢n vi√™n</th>
                                </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200">
                                <tr th:each="imp : ${reportData}">
                                    <td class="px-2 sm:px-4 py-2 sm:py-3 text-left"
                                        th:text="${imp.product.productName}">
                                        SP
                                    </td>
                                    <td class="px-2 sm:px-4 py-2 sm:py-3 text-left" th:text="${imp.importDate}">Ng√†y
                                    </td>
                                    <td class="px-2 sm:px-4 py-2 sm:py-3 text-right" th:text="${imp.quantity}">SL</td>
                                    <td class="px-2 sm:px-4 py-2 sm:py-3 text-right"
                                        th:text="${#numbers.formatDecimal(imp.unitImportPrice * imp.quantity, 0, 'COMMA', 0, 'POINT')}">
                                        T·ªïng
                                    </td>
                                    <td class="px-2 sm:px-4 py-2 sm:py-3 text-left" th:text="${imp.employee.fullName}">
                                        NV
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                            <!-- EXPORT_ONLY -->
                            <table th:case="'EXPORT_ONLY'" class="min-w-full text-sm text-gray-800">
                                <thead class="bg-[#FFF8E1] text-xs font-semibold text-gray-700 uppercase">
                                <tr>
                                    <th class="px-2 sm:px-4 py-2 sm:py-3 text-left">S·∫£n ph·∫©m</th>
                                    <th class="px-2 sm:px-4 py-2 sm:py-3 text-left">Ng√†y xu·∫•t</th>
                                    <th class="px-2 sm:px-4 py-2 sm:py-3 text-right">S·ªë l∆∞·ª£ng</th>
                                    <th class="px-2 sm:px-4 py-2 sm:py-3 text-right">T·ªïng ti·ªÅn (VND)</th>
                                    <th class="px-2 sm:px-4 py-2 sm:py-3 text-left">Nh√¢n vi√™n</th>
                                </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200">
                                <tr th:each="ex : ${reportData}">
                                    <td class="px-2 sm:px-4 py-2 sm:py-3 text-left" th:text="${ex.product.productName}">
                                        SP
                                    </td>
                                    <td class="px-2 sm:px-4 py-2 sm:py-3 text-left" th:text="${ex.exportDate}">Ng√†y</td>
                                    <td class="px-2 sm:px-4 py-2 sm:py-3 text-right" th:text="${ex.quantity}">SL</td>
                                    <td class="px-2 sm:px-4 py-2 sm:py-3 text-right"
                                        th:text="${#numbers.formatDecimal(ex.unitExportPrice * ex.quantity, 0, 'COMMA', 0, 'POINT')}">
                                        T·ªïng
                                    </td>
                                    <td class="px-2 sm:px-4 py-2 sm:py-3 text-left" th:text="${ex.employee.fullName}">NV
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                            <!-- IMPORT_EXPORT -->
                            <div th:case="'IMPORT_EXPORT'">
                                <h6 class="font-bold mt-3 mb-2 text-[#3e2723]">
                                    üìÖ Nh·∫≠p h√†ng
                                </h6>
                                <table class="min-w-full text-sm text-gray-800 mb-6">
                                    <thead class="bg-[#FFF8E1] text-xs font-semibold text-gray-700 uppercase">
                                    <tr>
                                        <th class="px-2 sm:px-4 py-2 sm:py-3 text-left">S·∫£n ph·∫©m</th>
                                        <th class="px-2 sm:px-4 py-2 sm:py-3 text-left">Ng√†y nh·∫≠p</th>
                                        <th class="px-2 sm:px-4 py-2 sm:py-3 text-right">S·ªë l∆∞·ª£ng</th>
                                        <th class="px-2 sm:px-4 py-2 sm:py-3 text-right">T·ªïng ti·ªÅn (VND)</th>
                                        <th class="px-2 sm:px-4 py-2 sm:py-3 text-left">Nh√¢n vi√™n</th>
                                    </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200">
                                    <tr th:each="imp : ${reportData[0].imports}">
                                        <td class="px-2 sm:px-4 py-2 sm:py-3 text-left"
                                            th:text="${imp.product.productName}">SP
                                        </td>
                                        <td class="px-2 sm:px-4 py-2 sm:py-3 text-left" th:text="${imp.importDate}">Ng√†y
                                        </td>
                                        <td class="px-2 sm:px-4 py-2 sm:py-3 text-right" th:text="${imp.quantity}">SL
                                        </td>
                                        <td class="px-2 sm:px-4 py-2 sm:py-3 text-right"
                                            th:text="${#numbers.formatDecimal(imp.unitImportPrice * imp.quantity, 0, 'COMMA', 0, 'POINT')}">
                                            T·ªïng
                                        </td>
                                        <td class="px-2 sm:px-4 py-2 sm:py-3 text-left"
                                            th:text="${imp.employee.fullName}">
                                            NV
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                                <h6 class="font-bold mt-4 mb-2 text-[#3e2723]">
                                    üìÑ Xu·∫•t h√†ng
                                </h6>
                                <table class="min-w-full text-sm text-gray-800">
                                    <thead class="bg-[#FFF8E1] text-xs font-semibold text-gray-700 uppercase">
                                    <tr>
                                        <th class="px-2 sm:px-4 py-2 sm:py-3 text-left">S·∫£n ph·∫©m</th>
                                        <th class="px-2 sm:px-4 py-2 sm:py-3 text-left">Ng√†y xu·∫•t</th>
                                        <th class="px-2 sm:px-4 py-2 sm:py-3 text-right">S·ªë l∆∞·ª£ng</th>
                                        <th class="px-2 sm:px-4 py-2 sm:py-3 text-right">T·ªïng ti·ªÅn (VND)</th>
                                        <th class="px-2 sm:px-4 py-2 sm:py-3 text-left">Nh√¢n vi√™n</th>
                                    </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200">
                                    <tr th:each="ex : ${reportData[0].exports}">
                                        <td class="px-2 sm:px-4 py-2 sm:py-3 text-left"
                                            th:text="${ex.product.productName}">
                                            SP
                                        </td>
                                        <td class="px-2 sm:px-4 py-2 sm:py-3 text-left" th:text="${ex.exportDate}">
                                            Ng√†y
                                        </td>
                                        <td class="px-2 sm:px-4 py-2 sm:py-3 text-right" th:text="${ex.quantity}">SL
                                        </td>
                                        <td class="px-2 sm:px-4 py-2 sm:py-3 text-right"
                                            th:text="${#numbers.formatDecimal(ex.unitExportPrice * ex.quantity, 0, 'COMMA', 0, 'POINT')}">
                                            T·ªïng
                                        </td>
                                        <td class="px-2 sm:px-4 py-2 sm:py-3 text-left"
                                            th:text="${ex.employee.fullName}">
                                            NV
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
          // Set ng√†y m·∫∑c ƒë·ªãnh
          var today = new Date().toISOString().split('T')[0];
          var start = document.getElementById('start');
          var end = document.getElementById('end');
          if (!start.value) start.value = today;
          if (!end.value) end.value = today;

          var focusInput = document.getElementById('start');
          if (focusInput) focusInput.focus();

          // Ki·ªÉm tra b√°o c√°o tr∆∞·ªõc khi t·∫£i Excel
          var downloadBtn = document.getElementById('downloadExcelBtn');
          var hiddenLink = document.getElementById('hiddenExcelLink');
          downloadBtn.addEventListener('click', function (e) {
              var hasData = !!document.querySelector('#reportDataExist');
              if (hasData) {
                  // L·∫•y gi√° tr·ªã form hi·ªán t·∫°i
                  var startDate = document.getElementById('start').value;
                  var endDate = document.getElementById('end').value;
                  var type = document.getElementById('type').value;
                  var excelUrl = '/report/download-excel?startDate=' + encodeURIComponent(startDate)
                               + '&endDate=' + encodeURIComponent(endDate)
                               + '&type=' + encodeURIComponent(type);
                  hiddenLink.setAttribute('href', excelUrl);
                  hiddenLink.click();
              } else {
                  showWarning('·∫§n v√†o n√∫t xem b√°o c√°o tr∆∞·ªõc nh√©.');
              }
          });
        });
    </script>
</div>
</body>
</html>